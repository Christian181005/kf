<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Archivierte Termine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-100 min-h-screen">

<div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold text-gray-800 mb-6">ðŸ“¦ Archivierte Termine</h1>

    <div id="tableWrapper" class="bg-white rounded-lg shadow overflow-hidden">
        <table class="min-w-full table-auto">
            <thead class="bg-gray-200 text-gray-700">
                <tr>
                    <th class="px-6 py-3 text-left text-sm font-semibold">Klasse</th>
                    <th class="px-6 py-3 text-left text-sm font-semibold">Datum</th>
                    <th class="px-6 py-3 text-left text-sm font-semibold">Uhrzeit</th>
                    <th class="px-6 py-3 text-left text-sm font-semibold">Ort</th>
                    <th class="px-6 py-3 text-left text-sm font-semibold">Verantwortlich</th>
                </tr>
            </thead>
            <tbody id="archiveTableBody" class="divide-y divide-gray-100">
                <tr>
                    <td colspan="5" class="text-center px-6 py-4 text-gray-500">Lade archivierte Daten...</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    async function loadArchive() {
        try {
            const res = await fetch('json/archive.json');
            const text = await res.text();
            const data = text.trim() ? JSON.parse(text) : [];

            const tbody = document.getElementById('archiveTableBody');
            tbody.innerHTML = '';

            if (!data.length) {
                tbody.innerHTML = `<tr><td colspan="5" class="px-6 py-4 text-center text-gray-500">Keine archivierten Termine gefunden.</td></tr>`;
                return;
            }

            data.forEach(item => {
                const date = formatDate(item.d1 || item.d2 || item.d3);
                const time = item.nr1 || item.nr2 || item.nr3 || "â€”";
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">${item.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${date}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${time}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${item.room_kl || "â€”"}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${item.kv || "â€”"}</td>
                `;
                tbody.appendChild(row);
            });
        } catch (err) {
            console.error('Fehler beim Laden des Archivs:', err);
            document.getElementById('archiveTableBody').innerHTML =
                `<tr><td colspan="5" class="text-center px-6 py-4 text-red-500">Fehler beim Laden der archivierten Daten.</td></tr>`;
        }
    }

    function formatDate(dateStr) {
        if (!dateStr || dateStr.length !== 8) return "â€”";
        return `${dateStr.substr(6,2)}.${dateStr.substr(4,2)}.${dateStr.substr(0,4)}`;
    }

    document.addEventListener('DOMContentLoaded', loadArchive);
</script>

</body>
</html>
